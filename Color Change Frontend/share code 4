// ===== About modal interactions =====
(function() {
  const aboutBtn = document.getElementById('aboutBtn');
  const aboutBackdrop = document.getElementById('aboutBackdrop');
  const aboutModal = document.getElementById('aboutModal');
  const aboutClose = aboutModal ? aboutModal.querySelector('.about-close') : null;
  const aboutOkay = document.getElementById('aboutOkay');

  let lastFocused = null;

  function openAbout() {
    if (!aboutBackdrop || !aboutModal) return;
    lastFocused = document.activeElement;
    aboutBackdrop.classList.add('show');
    aboutBackdrop.setAttribute('aria-hidden', 'false');
    // small delay then focus
    setTimeout(() => {
      const focusTarget = aboutModal.querySelector('.about-action') || aboutClose || aboutModal;
      if (focusTarget) focusTarget.focus();
    }, 80);
    // prevent body scroll while modal open
    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';
  }

  function closeAbout() {
    if (!aboutBackdrop || !aboutModal) return;
    aboutBackdrop.classList.remove('show');
    aboutBackdrop.setAttribute('aria-hidden', 'true');
    // restore scroll
    document.documentElement.style.overflow = '';
    document.body.style.overflow = '';
    // restore focus
    if (lastFocused && typeof lastFocused.focus === 'function') {
      lastFocused.focus();
    }
  }

  // click handlers
  if (aboutBtn) aboutBtn.addEventListener('click', (e) => { e.preventDefault(); openAbout(); });
  if (aboutClose) aboutClose.addEventListener('click', closeAbout);
  if (aboutOkay) aboutOkay.addEventListener('click', closeAbout);

  // click outside modal -> close
  if (aboutBackdrop) {
    aboutBackdrop.addEventListener('click', (e) => {
      if (e.target === aboutBackdrop) closeAbout();
    });
  }

  // ESC to close
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      const isOpen = aboutBackdrop && aboutBackdrop.classList.contains('show');
      if (isOpen) closeAbout();
    }
    // trap focus inside modal when open (basic)
    if (e.key === 'Tab') {
      const isOpen = aboutBackdrop && aboutBackdrop.classList.contains('show');
      if (!isOpen) return;
      const focusables = aboutModal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (!focusables.length) return;
      const first = focusables[0];
      const last = focusables[focusables.length - 1];
      if (e.shiftKey && document.activeElement === first) {
        e.preventDefault();
        last.focus();
      } else if (!e.shiftKey && document.activeElement === last) {
        e.preventDefault();
        first.focus();
      }
    }
  });
})();
