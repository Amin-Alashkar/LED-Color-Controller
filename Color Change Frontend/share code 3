async def custom_knight_rider_loop(hex_color: str, delay: float = 0.03):
    """
    Advanced Knight Rider:
    - LED with glowing tail moves back and forth smoothly.
    """
    global stop_requested
    r_base = int(hex_color[1:3], 16)
    g_base = int(hex_color[3:5], 16)
    b_base = int(hex_color[5:7], 16)

    position = 0
    direction = 1
    tail_length = 6  # عدد الليدات يلي يشكلو الذيل

    while not stop_requested:
        neo.clear_strip()

        for i in range(tail_length):
            idx = position - i * direction
            if 0 <= idx < NUM_LEDS:
                # تأثير تدريجي للذيل
                brightness = max(0, 255 - i * (255 // tail_length))
                neo.set_led_color(
                    idx,
                    (r_base * brightness) // 255,
                    (g_base * brightness) // 255,
                    (b_base * brightness) // 255
                )

        neo.update_strip()
        await asyncio.sleep(delay)

        position += direction
        if position >= NUM_LEDS - 1 or position <= 0:
            direction *= -1  # غيّر الاتجاه لما توصل الأطراف

    neo.clear_strip()
    neo.update_strip()
