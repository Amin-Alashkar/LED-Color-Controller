async def meteor_shower_loop(delay_per_step: float = 0.05):
    global stop_requested
    
    # ألوان عشوائية - يمكن توليد أي لون
    def get_random_color():
        return (
            random.randint(50, 255),   # الأحمر
            random.randint(50, 255),   # الأخضر
            random.randint(50, 255)    # الأزرق
        )
    
    # قائمة لتخزين الأفاعي النشطة
    active_snakes = []
    next_snake_id = 0
    last_snake_end = -100  # لتتبع نهاية آخر أفعى
    
    while not stop_requested:
        # تحديد إذا كان يجب إضافة أفعى جديدة
        current_pos = len(active_snakes)
        
        # شرط إضافة أفعى جديدة: لا توجد أفاعي أو انتهت المسافة الآمنة
        should_add_snake = (len(active_snakes) == 0 or 
                           (last_snake_end <= current_pos - 3 and 
                            current_pos - last_snake_end <= 15))
        
        if should_add_snake and random.choice([True, False]):  # عشوائية في الوقت
            # إنشاء أفعى جديدة بخصائص عشوائية
            snake_length = random.randint(5, 12)  # طول عشوائي بين 5 و12
            snake_color = get_random_color()      # لون عشوائي
            
            active_snakes.append({
                'id': next_snake_id,
                'length': snake_length,
                'color': snake_color,
                'progress': 0,
                'head_pos': 0
            })
            next_snake_id += 1
            last_snake_end = current_pos + snake_length
        
        # مسح الشريط
        neo.clear_strip()
        
        # تحديث ورسم الأفاعي النشطة
        snakes_to_remove = []
        
        for snake in active_snakes:
            snake_id = snake['id']
            snake_length = snake['length']
            color_base = snake['color']
            progress = snake['progress']
            head_pos = snake['head_pos']
            
            # رسم الأفعى (الرأس والذيل)
            for i in range(snake_length):
                pos = head_pos - i  # الذيل يمتد للخلف
                if 0 <= pos < NUM_LEDS:
                    # تدرج اللون (فاتح في الرأس، داكن في الذيل)
                    factor = (snake_length - i) / snake_length
                    r = int(color_base[0] * factor)
                    g = int(color_base[1] * factor)
                    b = int(color_base[2] * factor)
                    
                    neo.set_led_color(
                        pos,
                        int(r * BRIGHTNESS_SCALE),
                        int(g * BRIGHTNESS_SCALE),
                        int(b * BRIGHTNESS_SCALE)
                    )
            
            # تحريك الأفعى
            snake['head_pos'] += 1
            snake['progress'] += 1
            
            #檢查 إذا كانت الأفعى قد انتهت (خرجت من الشريط)
            if snake['head_pos'] - snake_length >= NUM_LEDS:
                snakes_to_remove.append(snake)
        
        # إزالة الأفاعي المنتهية
        for snake in snakes_to_remove:
            active_snakes.remove(snake)
            # تحديث آخر موضع لأفعى (لضمان المسافات)
            if active_snakes:
                last_snake_end = max(snake['head_pos'] for snake in active_snakes)
            else:
                last_snake_end = -100
        
        # تطبيق التحديثات
        neo.update_strip()
        await asyncio.sleep(delay_per_step)
    
    # تنظيف عند التوقف
    neo.clear_strip()
    neo.update_strip()
